<!DOCTYPE html>
<html>

<head>
    <title>Install Invoice Ninja and Nextcloud with Docker</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>


    <div class="page">
        <div class="nav">
            <h3 class="nav_title">Contents</h3>
            <ul>
                <a href="#Why">
                    <li>Why would I do this?</li>
                </a>

                <a href="#Docker">
                    <li>Install Docker</li>
                </a>
                <a href="#Nextcloud">
                    <li>Install Nextcloud</li>
                </a>
                <a href="#INinja">
                    <li>Install Invoice Ninja</li>
                </a>
                <a href="#Homepage">
                    <li>Create a homepage which directs to both</li>
                </a>
                <a href="#Debug">
                    <li>Troubleshooting</li>
                </a>
            </ul>
        </div>
        <div class="header">
            <h1>Installing Nextcloud and Invoice Ninja on the same server using Docker</h1>
        </div>
        <div class="main_content">

            <a id="Why">
                <h3>Why would I do this?</h3>
            </a>
            <img src="images/nextcloud-square-logo.png" id="nextcloud-intro-logo">
            <p>
                Finances and Files are the most difficult things for a business to keep track of.
                Luckily,Open Source software is trying to make that easier.
            </p>
            <img src="images/InvoiceNinja-Logo-Round-300x300.png" id="INinja-intro-logo">
            <p>
                Nextcloud is similar to Dropbox,
                but it is entirely hosted on your own server, making sure that your files stay confidential.
                It also provides features like collaborating on documents, chat and even allows calls.
            </p>
            <p>
                Invoice Ninja allows you to send invoices, handle expenses and a lot more. Together, they
                can form the backbone of any business infrastructure.
            </p>
            <p>
                In this tutorial, you will learn how
                to set up both inside of Docker containers on a Ubuntu server, and have a homepage which
                can direct you between the two using Apache
            </p>

            <a id="Docker">
                <h3>Install Docker</h3>
            </a>
            <p>
                The first thing you need to do is to install Docker. This part of the tutorial is
                almost identical to the <a href="https://docs.docker.com/engine/install/ubuntu/">official Docker
                    setup guide</a>, so you can follow it there if you would prefer. Both of the services will
                run inside of Docker containers, so you can’t run them until it fully setup.
            </p>
            <p>
                Make sure there are no older versions installed before you begin:
            </p>
            <p class="code">
                sudo apt-get remove docker docker-engine docker.io containerd runc
            </p>
            <p>
                Then you wil need to run:
            </p>
            <p class="code">
                sudo apt update
            </p>
            <p>
                This refreshes your computers list of packages it can install. We do it before installing
                things just to make sure we always get the most up to date version
            </p>
            <p>
                Docker needs us to be able to use apt over https, so we need to install some packages to
                allow that before we can start installing Docker
            </p>
            <p class="code">
                sudo apt install \<br />
                apt-transport-https \<br />
                ca-certificates \<br />
                curl \<br />
                gnupg-agent \<br />
                software-properties-common
            </p>
            <p>Now add Docker's GPG key to your system:</p>
            <p class="code">
                curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
            </p>
            <p>
                We will use the stable version of docker, which means it is less likely to break,
                but also isn’t as up to date as the test or nightly versions. We add the repository for it like this:
            </p>
            <p class="code">
                sudo add-apt-repository \<br />
                "deb [arch=amd64] https://download.docker.com/linux/ubuntu \<br />
                $(lsb_release -cs) \<br />
                stable"
            </p>
            <p>
                And now we can finally install Docker itself:
            </p>
            <p class="code">
                sudo apt update<br /><br />
                sudo apt-get install docker-ce docker-ce-cli containerd.io
            </p>

            <p>
                We will also install docker-compose, which allows images to be ran together.
                This is what Invoice Ninja uses, as it has a database and an Nginx server
                running alongside the app iteself
            </p>
            <p class="code">
                sudo apt install docker-compose
            </p>
            <a id="Nextcloud">
                <h3>Install Nextcloud</h3>
                <p>
                    Nextcloud installation is really simple when you have Docker. You run a single command,
                    and it downloads the Nextcloud image for Docker, runs it, and exposes a port so you can access it.
                </p>
                <p class="code">
                    sudo docker run -d -p 8080:80 --restart unless-stopped nextcloud
                </p>
            </a>
            <a id="INinja">
                <h3>Install Invoice Ninja</h3>
                <p>First, we download the repo from GitHub, and then move into the directory</p>
                <p class="code">
                    git clone https://github.com/invoiceninja/dockerfiles.git<br /><br />
                    cd dockerfiles
                </p>
                <p>
                    Now, we need to make some changes to the env and docker-compose file.
                    You can do this in your text editor of choice. I personally used VS Code,
                    which you can install and open in the directory with
                </p>
                <p class="code">
                    sudo snap install code –classic<br \> <br \>
                    code .
                </p>
                <p>Then, you’ll need to generate an app key</p>
                <p class="code">sudo docker run --rm -it invoiceninja/invoiceninja php artisan key:generate --show</p>
                <p>
                    At the end of the output of that command will be a string of characters, beginning with base64.
                    Copy the entire line and paste it into the APP_KEY field of the env file. (Make sure to remove the
                    placeholder!).
                </p>
                <p>
                    We then need to change our APP_URL. This tutorial is focussing on running everything on your local
                    network, so we will use our local IP address and port here, but if you are hosting somewhere off
                    your network you will use your domain name in this field. To get the IP address for a local install,
                    run:
                </p>
                <p class="code">
                    hostname -I
                </p>
                <p>and copy the IPv4 address listed there (it should be 4 numbers separated by full stops).
                    Paste that into the field and add your port like this:
                </p>
                <p class="code">
                    http://192.168.0.27:8081
                </p>
                <p>
                    That’s your env file finished! Save it, close it, and open your docker-compose file.
                    In this, find line 17 and change 80:80 to 8081:80. Save, exit, and then run the following command
                </p>
                <p class="code">
                    sudo chown -R 1500:1500 docker/app<br \> <br \>
                    sudo docker-compose up -d
                </p>
                <p>
                    You can test it by opening your browser and navigating to the address you typed before
                </p>
            </a>
            <a id="Homepage">
                <h3>Create a homepage which directs to both</h3>
                <p>
                    We will use Apache to serve our homepage. We install it with:
                </p>
                <p class="code">
                    sudo apt install apache2
                </p>
                <p>
                    We can test that by going to the IP address we found above, but with no ports this time.
                    This is because Apache is running on port 80, which is the default port that your web browser is
                    going to.
                </p>
                <p>
                    Now that we have Apache running, it's time to customise what it shows us. Navigate to
                    <code>/var/www/html</code> inside of this, you will see a file called <code>index.html</code>.
                    Open this in your text editor of choice, and delete everything inside. Replace it with the
                    following:
                    <pre class=code>

    &lt!DOCTYPE html&gt
    &lthtml&gt                        
        &lthead&gt
            &lttitle&gtRedirect&lt/title&gt
        &lt/head&gt  
        &ltbody&gt
            &ltul&gt
                &ltli&gt&lta href="&ltINSERT Nexcloud IP AND PORT HERE&gt"&gtNextcloud&lt/a&gt&lt/li&gt
                &ltli&gt&lta href="&ltINSERT Invoice Ninja IP AND PORT HERE&gt"&gtInvoice Ninja&lt/a&gt&lt/li&gt
            &lt/ul&gt
        &lt/body&gt    
    &lt/html&gt</pre>
            <a id="Debug">
                <h3>Troubleshooting</h3>
            </a>
            <ul>
                <h5>Invoice Ninja error 500</h5>
                This error seems to be caused by issues with the key we generated. To resolve it, rerun
                <p class="code">sudo docker run --rm -it invoiceninja/invoiceninja php artisan key:generate --show</p>
                and paste the result over the top of the code you already generated
            </ul>
            <ul>
                <h5>Invoice Ninja warning about debug mode</h5>
                This issue means you did not change the APP_DEBUG variable in the env file to false. It should be on
                line 3 of the file
            </ul>
            <ul>
                <h5>Invoice Ninja email</h5>
                Some email services such as Gmail will require you to enable logging in from less secure devices in
                order
                for Invoice Ninja to access them
            </ul>

        </div>
    </div>
</body>

</html>